frontend http
    bind :80
    http-request redirect scheme https

frontend https
    bind :443
    mode tcp
    tcp-request content accept if { req.ssl_hello_type 1 }
    tcp-request inspect-delay 3s

%{ for service in services ~}
    use_backend ${service.host} if { req.ssl_sni -i ${service.fqdn_external} }
    use_backend ${service.host} if { req.ssl_sni -m sub ${service.fqdn_external} }
%{ endfor ~}
