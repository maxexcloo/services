%{ for k, server in servers ~}
%{ if contains(server.flags, "homepage") ~}
%{ if contains(server.flags, "caddy") || length([for service in services: service if service.enable_homepage_widget == false && service.fqdn != null && service.server == k]) > 0 ~}
- ${server.description} (${servers[server.location].description}):
%{ if contains(server.flags, "caddy") ~}
  - OpenSpeedTest (External):
    - href: https://speedtest.${server.fqdn_external}
      icon: openspeedtest
  - OpenSpeedTest (Internal):
    - href: https://speedtest.${server.fqdn_internal}
      icon: openspeedtest
%{ endif ~}
%{ for service in services ~}
%{ if service.enable_homepage_widget == false && service.fqdn != null && service.server == k ~}
  - ${replace(service.description, " (${server.description})", "")}:
    - href: ${service.url}
      icon: ${service.homepage_icon}
%{ endif ~}
%{ endfor ~}
%{ endif ~}
%{ endif ~}
%{ endfor ~}
- Cloud:
%{ for service in services ~}
%{ if service.enable_homepage_widget == false && service.fqdn != null && service.server == null ~}
  - ${service.description}:
    - href: ${service.url}
      icon: ${service.homepage_icon}
%{ endif ~}
%{ endfor ~}
